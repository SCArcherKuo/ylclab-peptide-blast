params {
    // Help message
    help = false
}

// Process configuration
process {
    // Default process settings
    cpus   = { 2      * task.attempt }
    memory = { 4.GB   * task.attempt }
    time   = { 2.h    * task.attempt }

    errorStrategy = { task.exitStatus in ((130..145) + 104 + 175) ? 'retry' : 'finish' }
    maxRetries    = 1
    maxErrors     = '-1'

    // Set bash options
    shell = [
        "bash",
        "-C",         // No clobber - prevent output redirection from overwriting files.
        "-e",         // Exit if a tool returns a non-zero status/exit code
        "-u",         // Treat unset variables and parameters as an error
        "-o",         // Returns the status of the last command to exit..
        "pipefail"    //   ..with a non-zero status or zero if all successfully execute
    ]
}

// Execution profiles
profiles {
    standard {
        process.executor = 'local'
    }
    
    docker {
        docker.enabled = true
    }
    
    test {
        includeConfig 'test.config' 
    }
}

// Workflow execution settings
executor {
    $local {
        cpus = 8
        memory = '32 GB'
    }
}

// Timeline and execution reports
timeline {
    enabled = true
    file = "${params.output_dir}/reports/timeline.html"
    overwrite = true
}

report {
    enabled = true
    file = "${params.output_dir}/reports/report.html"
    overwrite = true
}

trace {
    enabled = true
    file = "${params.output_dir}/reports/trace.txt"
    overwrite = true
}

dag {
    enabled = true
    file = "${params.output_dir}/reports/dag.dot"
    overwrite = true
}

// Workflow metadata
manifest {
    name = 'peptide-blast'
    author = 'Peptide BLAST Workflow'
    description = 'Nextflow pipeline for peptide BLAST analysis'
    version = '1.0.0'
    nextflowVersion = '>=25.04.7'
}